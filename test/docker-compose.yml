# Run from project root with:
# `docker-compose -f test/docker-compose.yml up`

version: '2'
services:
  test-app:
    extends:
      service: app
      file: ../docker-compose.yml

    environment:
      - OAM_BUCKET_PREFIX=test-$TRAVIS_BUILD_NUMBER
      # Variables that can be inherited from the host ENV. All
      # others will come from .env
      - NODE_ENV
      - OAM_DEBUG
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY

    # Make container's localhost the same as host's localhost.
    # So the DB should either be on the host or remote, not in a
    # docker container.
    network_mode: "host"

    # Mount your code live into the container so you don't need
    # to rebuild the container everytime.
    volumes:
      - ../:/app

    # Run both foreman and a static file server for testing purposes
    command: /bin/sh -c
      "./node_modules/.bin/http-server ./test &
      ./node_modules/.bin/nf start"
